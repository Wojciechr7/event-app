{"version":3,"sources":["webpack:///C:/Users/robcyk/Desktop/projects/event-app/node_modules/@firebase/installations/dist/index.esm.js","webpack:///C:/Users/robcyk/Desktop/projects/event-app/node_modules/@firebase/installations/node_modules/tslib/tslib.es6.js","webpack:///C:/Users/robcyk/Desktop/projects/event-app/node_modules/@firebase/messaging/dist/index.esm.js","webpack:///C:/Users/robcyk/Desktop/projects/event-app/node_modules/@firebase/messaging/node_modules/tslib/tslib.es6.js","webpack:///C:/Users/robcyk/Desktop/projects/event-app/node_modules/firebase/messaging/dist/index.esm.js","webpack:///C:/Users/robcyk/Desktop/projects/event-app/node_modules/idb/build/idb.js"],"names":["name","version","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","_a","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","error","code","includes","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","Date","now","getErrorFromResponse","requestName","responseJson","errorData","label","json","sent","create","serverCode","serverMessage","message","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","result","responseExpiresIn","Number","replace","createInstallationRequest","fid","endpoint","body","request","responseValue","registeredInstallationEntry","_b","authVersion","appId","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","Promise","resolve","setTimeout","bufferToBase64UrlSafe","array","b64","btoa","String","fromCharCode","apply","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","crypto_1","self","crypto","msCrypto","getRandomValues","encode","test","b64String","substr","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","set","value","key","db","tx","getKey","transaction","objectStore","put","complete","remove","update","updateFn","store","oldValue","newValue","get","undefined","appName","getInstallationEntry","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","clearTimedOutRequest","navigator","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","e_1","trys","push","updateInstallationRequest","hasInstallationRequestTimedOut","generateAuthTokenRequest","platformLoggerProvider","platformLogger","completedAuthToken","getGenerateAuthTokenEndpoint","getImmediate","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","getId","console","getToken","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","deleteInstallation","extractAppConfig","app","options","getMissingValueError","configKeys","configKeys_1","configKeys_1_1","next","done","keyName","e_1_1","call","valueName","registerInstallations","instance","installationsName","INTERNAL","registerComponent","container","getProvider","registerVersion","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","__assign","assign","t","s","i","n","arguments","length","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__decorate","decorators","target","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","rejected","then","__generator","_","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","__exportStar","m","exports","__values","o","__read","ar","__spread","concat","__spreadArrays","il","k","a","j","jl","__await","__asyncGenerator","asyncIterator","q","resume","settle","fulfill","shift","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__importStar","mod","__esModule","__importDefault","ERROR_MAP","errorFactory","DEFAULT_PUBLIC_VAPID_KEY","ENDPOINT","FN_CAMPAIGN_ID","FN_CAMPAIGN_NAME","FN_CAMPAIGN_TIME","FN_CAMPAIGN_ANALYTICS_ENABLED","MessageType","isArrayBufferEqual","byteLength","viewA","DataView","viewB","getUint8","toBase64","arrayBuffer","uint8Version","arrayBufferToBase64","base64String","SubscriptionManager","services","subscription","vapidKey","subscribeOptions","responseData","err_1","getBody","getEndpoint","errorInfo","updateToken","tokenDetails","updateOptions","err_2","fcmToken","deleteToken","unsubscribeOptions","err_3","installations","p256dh","auth","web","buffer","applicationPubKey","base64ToArrayBuffer","padding","repeat","base64","rawData","atob","outputArray","charCodeAt","OLD_DB_NAME","OLD_OBJECT_STORE_NAME","handleDb","objectStoreNames","contains","subscriptionManager","openCursorRequest","openCursor","onerror","event","warn","onsuccess","cursor","close","indexedDB","deleteDatabase","cleanV1","open","_event","DbInterface","createTransaction","getIndex","index","runRequest","idbIndex","closeDatabase","mode","getDb","objectStoreName","promisify","oncomplete","_this","dbName","dbVersion","onupgradeneeded","onDbUpgrade","TokenDetailsModel","_super","keyPath","createIndex","unique","cursorRequest_1","createTime","fcmPushSet","cursorRequest_2","getTokenDetailsFromToken","validateInputs","getTokenDetailsFromSWScope","swScope","saveTokenDetails","fcmSenderId","details","input","ArrayBuffer","UNCOMPRESSED_PUBLIC_KEY_SIZE","VapidDetailsModel","getVapidFromSWScope","saveVapidDetails","deleteVapidDetails","TOKEN_EXPIRATION_MILLIS","BaseController","vapidDetailsModel","messagingSenderId","tokenDetailsModel","permission","swReg","publicVapidKey","pushSubscription","getNotificationPermission","requestNotificationPermission","getSWRegistration_","getPublicVapidKey_","getPushSubscription","scope","manageExistingToken","getNewToken","isTokenValid","isTokenStillValid","deleteTokenFromDB","updatedToken","allDetails","newToken","registration","pushManager","getSubscription","unsubscribe","e_2","swRegistration","subscribe","userVisibleOnly","applicationServerKey","requestPermission","useServiceWorker","_registration","usePublicVapidKey","_b64PublicKey","onMessage","_nextOrObserver","_error","_completed","onTokenRefresh","setBackgroundMessageHandler","_callback","all","Notification","getTokenDetailsModel","getVapidDetailsModel","getSubscriptionManager","isEndpointEqual","isAuthEqual","isP256dhEqual","FCM_MSG","SwController","bgMessageHandler","addEventListener","onPush","onSubChange","onNotificationClick","waitUntil","onPush_","onSubChange_","onNotificationClick_","msgPayload","hasVisibleClients","notificationDetails","notificationTitle","reg","actions","maxActions","data","err","hasVisibleClients_","sendMessageToWindowClients_","getNotificationData_","title","showNotification","link","windowClient","internalMsg","notification","action","stopImmediatePropagation","fcmOptions","click_action","location","origin","getWindowClient_","clients","openWindow","focus","createNewMsg","NOTIFICATION_CLICKED","attemptToMessageClient_","notificationInformation","callback","url","parsedURL","clientList","suitableClient","parsedClientUrl","URL","href","getClientList","client","postMessage","some","visibilityState","startsWith","PUSH_MSG_RECEIVED","map","vapidKeyFromDatabase","matchAll","type","includeUncontrolled","msgType","msgData","firebaseMessagingType","firebaseMessagingData","DEFAULT_SW_PATH","DEFAULT_SW_SCOPE","WindowController","registrationToUse","publicVapidKeyToUse","messageObserver","tokenRefreshObserver","onMessageInternal","observer","onTokenRefreshInternal","setupSWMessageListener_","permissionResult","ServiceWorkerRegistration","publicKey","parsedKey","nextOrObserver","completed","waitForRegistrationToActivate_","serviceWorker","installing","waiting","active","state","stateChangeListener","removeEventListener","register","browserErrorMessage","eventType","analytics","getEventType","analyticsProvider","logEvent","message_name","message_id","message_time","message_device_time","Math","floor","messageType","Error","registerMessaging","messagingName","factoryMethod","firebaseServices","isSupported","namespaceExports","setServiceProps","isSWControllerSupported","isWindowControllerSupported","cookieEnabled","window","PushSubscription","global","factory","toArray","arr","slice","promisifyRequest","promisifyRequestCall","obj","args","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","val","proxyRequestMethods","Constructor","proxyMethods","proxyCursorRequestMethods","Index","_index","IDBIndex","_cursor","_request","IDBCursor","methodName","ObjectStore","_store","IDBObjectStore","Transaction","idbTransaction","_tx","onabort","IDBTransaction","UpgradeDB","_db","IDBDatabase","DB","funcName","nativeObject","getAll","query","count","items","iterateCursor","openDb","upgradeCallback","deleteDb"],"mappings":"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","file":"firebase-messaging-es5.js","sourcesContent":["import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __assign, __values } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar name = \"@firebase/installations\";\nvar version = \"0.3.8\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallationRequest(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthTokenRequest(_a, installationEntry) {\r\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    platformLogger = platformLoggerProvider.getImmediate({\r\n                        optional: true\r\n                    });\r\n                    if (platformLogger) {\r\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\r\n                    }\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign(__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign(__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(dependencies).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallationRequest(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = dependencies.appConfig;\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\r\n        var app = container.getProvider('app').getImmediate();\r\n        // Throws if app isn't configured properly.\r\n        var appConfig = extractAppConfig(app);\r\n        var platformLoggerProvider = container.getProvider('platform-logger');\r\n        var dependencies = {\r\n            appConfig: appConfig,\r\n            platformLoggerProvider: platformLoggerProvider\r\n        };\r\n        return {\r\n            app: app,\r\n            getId: function () { return getId(dependencies); },\r\n            getToken: function (forceRefresh) {\r\n                return getToken(dependencies, forceRefresh);\r\n            },\r\n            delete: function () { return deleteInstallation(dependencies); }\r\n        };\r\n    }, \"PUBLIC\" /* PUBLIC */));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import firebase from '@firebase/app';\nimport '@firebase/installations';\nimport { __spread, __awaiter, __generator, __extends, __assign } from 'tslib';\nimport { ErrorFactory, createSubscribe } from '@firebase/util';\nimport { Component } from '@firebase/component';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_MAP = (_a = {},\r\n    _a[\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */] = 'This method is available in a Window context.',\r\n    _a[\"only-available-in-sw\" /* AVAILABLE_IN_SW */] = 'This method is available in a service worker context.',\r\n    _a[\"should-be-overriden\" /* SHOULD_BE_INHERITED */] = 'This method should be overriden by extended classes.',\r\n    _a[\"bad-sender-id\" /* BAD_SENDER_ID */] = \"Please ensure that 'messagingSenderId' is set \" +\r\n        'correctly in the options passed into firebase.initializeApp().',\r\n    _a[\"permission-default\" /* PERMISSION_DEFAULT */] = 'The required permissions were not granted and dismissed instead.',\r\n    _a[\"permission-blocked\" /* PERMISSION_BLOCKED */] = 'The required permissions were not granted and blocked instead.',\r\n    _a[\"unsupported-browser\" /* UNSUPPORTED_BROWSER */] = \"This browser doesn't support the API's \" +\r\n        'required to use the firebase SDK.',\r\n    _a[\"notifications-blocked\" /* NOTIFICATIONS_BLOCKED */] = 'Notifications have been blocked.',\r\n    _a[\"failed-serviceworker-registration\" /* FAILED_DEFAULT_REGISTRATION */] = 'We are unable to register the ' +\r\n        'default service worker. {$browserErrorMessage}',\r\n    _a[\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */] = 'A service worker registration was the expected input.',\r\n    _a[\"get-subscription-failed\" /* GET_SUBSCRIPTION_FAILED */] = 'There was an error when trying to get ' +\r\n        'any existing Push Subscriptions.',\r\n    _a[\"invalid-saved-token\" /* INVALID_SAVED_TOKEN */] = 'Unable to access details of the saved token.',\r\n    _a[\"sw-reg-redundant\" /* SW_REG_REDUNDANT */] = 'The service worker being used for push was made redundant.',\r\n    _a[\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */] = 'A problem occured while subscribing the user to FCM: {$errorInfo}',\r\n    _a[\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */] = 'FCM returned no token when subscribing the user to push.',\r\n    _a[\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */] = 'A problem occured while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    _a[\"token-update-failed\" /* TOKEN_UPDATE_FAILED */] = 'A problem occured while updating the user from FCM: {$errorInfo}',\r\n    _a[\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */] = 'FCM returned no token when updating the user to push.',\r\n    _a[\"use-sw-before-get-token\" /* USE_SW_BEFORE_GET_TOKEN */] = 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    _a[\"invalid-delete-token\" /* INVALID_DELETE_TOKEN */] = 'You must pass a valid token into ' +\r\n        'deleteToken(), i.e. the token from getToken().',\r\n    _a[\"delete-token-not-found\" /* DELETE_TOKEN_NOT_FOUND */] = 'The deletion attempt for token could not ' +\r\n        'be performed as the token was not found.',\r\n    _a[\"delete-scope-not-found\" /* DELETE_SCOPE_NOT_FOUND */] = 'The deletion attempt for service worker ' +\r\n        'scope could not be performed as the scope was not found.',\r\n    _a[\"bg-handler-function-expected\" /* BG_HANDLER_FUNCTION_EXPECTED */] = 'The input to setBackgroundMessageHandler() must be a function.',\r\n    _a[\"no-window-client-to-msg\" /* NO_WINDOW_CLIENT_TO_MSG */] = 'An attempt was made to message a non-existant window client.',\r\n    _a[\"unable-to-resubscribe\" /* UNABLE_TO_RESUBSCRIBE */] = 'There was an error while re-subscribing ' +\r\n        'the FCM token for push messaging. Will have to resubscribe the ' +\r\n        'user on next visit. {$errorInfo}',\r\n    _a[\"no-fcm-token-for-resubscribe\" /* NO_FCM_TOKEN_FOR_RESUBSCRIBE */] = 'Could not find an FCM token ' +\r\n        'and as a result, unable to resubscribe. Will have to resubscribe the ' +\r\n        'user on next visit.',\r\n    _a[\"failed-to-delete-token\" /* FAILED_TO_DELETE_TOKEN */] = 'Unable to delete the currently saved token.',\r\n    _a[\"no-sw-in-reg\" /* NO_SW_IN_REG */] = 'Even though the service worker registration was ' +\r\n        'successful, there was a problem accessing the service worker itself.',\r\n    _a[\"bad-scope\" /* BAD_SCOPE */] = 'The service worker scope must be a string with at ' +\r\n        'least one character.',\r\n    _a[\"bad-vapid-key\" /* BAD_VAPID_KEY */] = 'The public VAPID key is not a Uint8Array with 65 bytes.',\r\n    _a[\"bad-subscription\" /* BAD_SUBSCRIPTION */] = 'The subscription must be a valid PushSubscription.',\r\n    _a[\"bad-token\" /* BAD_TOKEN */] = 'The FCM Token used for storage / lookup was not ' +\r\n        'a valid token string.',\r\n    _a[\"failed-delete-vapid-key\" /* FAILED_DELETE_VAPID_KEY */] = 'The VAPID key could not be deleted.',\r\n    _a[\"invalid-public-vapid-key\" /* INVALID_PUBLIC_VAPID_KEY */] = 'The public VAPID key must be a string.',\r\n    _a[\"use-public-key-before-get-token\" /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */] = 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.',\r\n    _a[\"public-vapid-key-decryption-failed\" /* PUBLIC_KEY_DECRYPTION_FAILED */] = 'The public VAPID key did not equal 65 bytes when decrypted.',\r\n    _a);\r\nvar errorFactory = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_PUBLIC_VAPID_KEY = new Uint8Array([\r\n    0x04,\r\n    0x33,\r\n    0x94,\r\n    0xf7,\r\n    0xdf,\r\n    0xa1,\r\n    0xeb,\r\n    0xb1,\r\n    0xdc,\r\n    0x03,\r\n    0xa2,\r\n    0x5e,\r\n    0x15,\r\n    0x71,\r\n    0xdb,\r\n    0x48,\r\n    0xd3,\r\n    0x2e,\r\n    0xed,\r\n    0xed,\r\n    0xb2,\r\n    0x34,\r\n    0xdb,\r\n    0xb7,\r\n    0x47,\r\n    0x3a,\r\n    0x0c,\r\n    0x8f,\r\n    0xc4,\r\n    0xcc,\r\n    0xe1,\r\n    0x6f,\r\n    0x3c,\r\n    0x8c,\r\n    0x84,\r\n    0xdf,\r\n    0xab,\r\n    0xb6,\r\n    0x66,\r\n    0x3e,\r\n    0xf2,\r\n    0x0c,\r\n    0xd4,\r\n    0x8b,\r\n    0xfe,\r\n    0xe3,\r\n    0xf9,\r\n    0x76,\r\n    0x2f,\r\n    0x14,\r\n    0x1c,\r\n    0x63,\r\n    0x08,\r\n    0x6a,\r\n    0x6f,\r\n    0x2d,\r\n    0xb1,\r\n    0x1a,\r\n    0x95,\r\n    0xb0,\r\n    0xce,\r\n    0x37,\r\n    0xc0,\r\n    0x9c,\r\n    0x6e\r\n]);\r\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\nvar FN_CAMPAIGN_ID = 'google.c.a.c_id';\r\nvar FN_CAMPAIGN_NAME = 'google.c.a.c_l';\r\nvar FN_CAMPAIGN_TIME = 'google.c.a.ts';\r\n/** Set to '1' if Analytics is enabled for the campaign */\r\nvar FN_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_MSG_RECEIVED\"] = \"push-msg-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2018 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isArrayBufferEqual(a, b) {\r\n    if (a == null || b == null) {\r\n        return false;\r\n    }\r\n    if (a === b) {\r\n        return true;\r\n    }\r\n    if (a.byteLength !== b.byteLength) {\r\n        return false;\r\n    }\r\n    var viewA = new DataView(a);\r\n    var viewB = new DataView(b);\r\n    for (var i = 0; i < a.byteLength; i++) {\r\n        if (viewA.getUint8(i) !== viewB.getUint8(i)) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction toBase64(arrayBuffer) {\r\n    var uint8Version = new Uint8Array(arrayBuffer);\r\n    return btoa(String.fromCharCode.apply(String, __spread(uint8Version)));\r\n}\r\nfunction arrayBufferToBase64(arrayBuffer) {\r\n    var base64String = toBase64(arrayBuffer);\r\n    return base64String\r\n        .replace(/=/g, '')\r\n        .replace(/\\+/g, '-')\r\n        .replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar SubscriptionManager = /** @class */ (function () {\r\n    function SubscriptionManager() {\r\n    }\r\n    SubscriptionManager.prototype.getToken = function (services, subscription, vapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, body, subscribeOptions, responseData, response, err_1, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(services)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        body = getBody(subscription, vapidKey);\r\n                        subscribeOptions = {\r\n                            method: 'POST',\r\n                            headers: headers,\r\n                            body: JSON.stringify(body)\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(services.app), subscribeOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_1 = _a.sent();\r\n                        throw errorFactory.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                            errorInfo: err_1\r\n                        });\r\n                    case 6:\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        if (!responseData.token) {\r\n                            throw errorFactory.create(\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n                        }\r\n                        return [2 /*return*/, responseData.token];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Update the underlying token details for fcmToken.\r\n     */\r\n    SubscriptionManager.prototype.updateToken = function (tokenDetails, services, subscription, vapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, body, updateOptions, responseData, response, err_2, message;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(services)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        body = getBody(subscription, vapidKey);\r\n                        updateOptions = {\r\n                            method: 'PATCH',\r\n                            headers: headers,\r\n                            body: JSON.stringify(body)\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(services.app) + \"/\" + tokenDetails.fcmToken, updateOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_2 = _a.sent();\r\n                        throw errorFactory.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                            errorInfo: err_2\r\n                        });\r\n                    case 6:\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        if (!responseData.token) {\r\n                            throw errorFactory.create(\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */);\r\n                        }\r\n                        return [2 /*return*/, responseData.token];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SubscriptionManager.prototype.deleteToken = function (services, tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var headers, unsubscribeOptions, response, responseData, message, err_3;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getHeaders(services)];\r\n                    case 1:\r\n                        headers = _a.sent();\r\n                        unsubscribeOptions = {\r\n                            method: 'DELETE',\r\n                            headers: headers\r\n                        };\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 5, , 6]);\r\n                        return [4 /*yield*/, fetch(getEndpoint(services.app) + \"/\" + tokenDetails.fcmToken, unsubscribeOptions)];\r\n                    case 3:\r\n                        response = _a.sent();\r\n                        return [4 /*yield*/, response.json()];\r\n                    case 4:\r\n                        responseData = _a.sent();\r\n                        if (responseData.error) {\r\n                            message = responseData.error.message;\r\n                            throw errorFactory.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                                errorInfo: message\r\n                            });\r\n                        }\r\n                        return [3 /*break*/, 6];\r\n                    case 5:\r\n                        err_3 = _a.sent();\r\n                        throw errorFactory.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                            errorInfo: err_3\r\n                        });\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SubscriptionManager;\r\n}());\r\nfunction getEndpoint(app) {\r\n    return ENDPOINT + \"/projects/\" + app.options.projectId + \"/registrations\";\r\n}\r\nfunction getHeaders(_a) {\r\n    var app = _a.app, installations = _a.installations;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, installations.getToken()];\r\n                case 1:\r\n                    authToken = _b.sent();\r\n                    return [2 /*return*/, new Headers({\r\n                            'Content-Type': 'application/json',\r\n                            Accept: 'application/json',\r\n                            'x-goog-api-key': app.options.apiKey,\r\n                            'x-goog-firebase-installations-auth': \"FIS \" + authToken\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getBody(subscription, vapidKey) {\r\n    var p256dh = arrayBufferToBase64(subscription.getKey('p256dh'));\r\n    var auth = arrayBufferToBase64(subscription.getKey('auth'));\r\n    var body = {\r\n        web: {\r\n            endpoint: subscription.endpoint,\r\n            p256dh: p256dh,\r\n            auth: auth\r\n        }\r\n    };\r\n    if (!isArrayBufferEqual(vapidKey.buffer, DEFAULT_PUBLIC_VAPID_KEY.buffer)) {\r\n        body.web.applicationPubKey = arrayBufferToBase64(vapidKey);\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction base64ToArrayBuffer(base64String) {\r\n    var padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    var base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    var rawData = atob(base64);\r\n    var outputArray = new Uint8Array(rawData.length);\r\n    for (var i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar OLD_DB_NAME = 'undefined';\r\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nfunction handleDb(db, services) {\r\n    if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n        // We found a database with the name 'undefined', but our expected object\r\n        // store isn't defined.\r\n        return;\r\n    }\r\n    var transaction = db.transaction(OLD_OBJECT_STORE_NAME);\r\n    var objectStore = transaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n    var subscriptionManager = new SubscriptionManager();\r\n    var openCursorRequest = objectStore.openCursor();\r\n    openCursorRequest.onerror = function (event) {\r\n        // NOOP - Nothing we can do.\r\n        console.warn('Unable to cleanup old IDB.', event);\r\n    };\r\n    openCursorRequest.onsuccess = function () {\r\n        var cursor = openCursorRequest.result;\r\n        if (cursor) {\r\n            // cursor.value contains the current record being iterated through\r\n            // this is where you'd do something with the result\r\n            var tokenDetails = cursor.value;\r\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n            subscriptionManager.deleteToken(services, tokenDetails);\r\n            cursor.continue();\r\n        }\r\n        else {\r\n            db.close();\r\n            indexedDB.deleteDatabase(OLD_DB_NAME);\r\n        }\r\n    };\r\n}\r\nfunction cleanV1(services) {\r\n    var request = indexedDB.open(OLD_DB_NAME);\r\n    request.onerror = function (_event) {\r\n        // NOOP - Nothing we can do.\r\n    };\r\n    request.onsuccess = function (_event) {\r\n        var db = request.result;\r\n        handleDb(db, services);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DbInterface = /** @class */ (function () {\r\n    function DbInterface() {\r\n        this.dbPromise = null;\r\n    }\r\n    /** Gets record(s) from the objectStore that match the given key. */\r\n    DbInterface.prototype.get = function (key) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.get(key); });\r\n    };\r\n    /** Gets record(s) from the objectStore that match the given index. */\r\n    DbInterface.prototype.getIndex = function (index, key) {\r\n        function runRequest(objectStore) {\r\n            var idbIndex = objectStore.index(index);\r\n            return idbIndex.get(key);\r\n        }\r\n        return this.createTransaction(runRequest);\r\n    };\r\n    /** Assigns or overwrites the record for the given value. */\r\n    // IndexedDB values are of type \"any\"\r\n    DbInterface.prototype.put = function (value) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.put(value); }, 'readwrite');\r\n    };\r\n    /** Deletes record(s) from the objectStore that match the given key. */\r\n    DbInterface.prototype.delete = function (key) {\r\n        return this.createTransaction(function (objectStore) { return objectStore.delete(key); }, 'readwrite');\r\n    };\r\n    /**\r\n     * Close the currently open database.\r\n     */\r\n    DbInterface.prototype.closeDatabase = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var db;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.dbPromise) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.dbPromise];\r\n                    case 1:\r\n                        db = _a.sent();\r\n                        db.close();\r\n                        this.dbPromise = null;\r\n                        _a.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Creates an IndexedDB Transaction and passes its objectStore to the\r\n     * runRequest function, which runs the database request.\r\n     *\r\n     * @return Promise that resolves with the result of the runRequest function\r\n     */\r\n    DbInterface.prototype.createTransaction = function (runRequest, mode) {\r\n        if (mode === void 0) { mode = 'readonly'; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var db, transaction, request, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getDb()];\r\n                    case 1:\r\n                        db = _a.sent();\r\n                        transaction = db.transaction(this.objectStoreName, mode);\r\n                        request = transaction.objectStore(this.objectStoreName);\r\n                        return [4 /*yield*/, promisify(runRequest(request))];\r\n                    case 2:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, new Promise(function (resolve, reject) {\r\n                                transaction.oncomplete = function () {\r\n                                    resolve(result);\r\n                                };\r\n                                transaction.onerror = function () {\r\n                                    reject(transaction.error);\r\n                                };\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /** Gets the cached db connection or opens a new one. */\r\n    DbInterface.prototype.getDb = function () {\r\n        var _this = this;\r\n        if (!this.dbPromise) {\r\n            this.dbPromise = new Promise(function (resolve, reject) {\r\n                var request = indexedDB.open(_this.dbName, _this.dbVersion);\r\n                request.onsuccess = function () {\r\n                    resolve(request.result);\r\n                };\r\n                request.onerror = function () {\r\n                    _this.dbPromise = null;\r\n                    reject(request.error);\r\n                };\r\n                request.onupgradeneeded = function (event) { return _this.onDbUpgrade(request, event); };\r\n            });\r\n        }\r\n        return this.dbPromise;\r\n    };\r\n    return DbInterface;\r\n}());\r\n/** Promisifies an IDBRequest. Resolves with the IDBRequest's result. */\r\nfunction promisify(request) {\r\n    return new Promise(function (resolve, reject) {\r\n        request.onsuccess = function () {\r\n            resolve(request.result);\r\n        };\r\n        request.onerror = function () {\r\n            reject(request.error);\r\n        };\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar TokenDetailsModel = /** @class */ (function (_super) {\r\n    __extends(TokenDetailsModel, _super);\r\n    function TokenDetailsModel(services) {\r\n        var _this = _super.call(this) || this;\r\n        _this.services = services;\r\n        _this.dbName = 'fcm_token_details_db';\r\n        _this.dbVersion = 4;\r\n        _this.objectStoreName = 'fcm_token_object_Store';\r\n        return _this;\r\n    }\r\n    TokenDetailsModel.prototype.onDbUpgrade = function (request, event) {\r\n        var db = request.result;\r\n        // Lack of 'break' statements is intentional.\r\n        switch (event.oldVersion) {\r\n            case 0: {\r\n                // New IDB instance\r\n                var objectStore = db.createObjectStore(this.objectStoreName, {\r\n                    keyPath: 'swScope'\r\n                });\r\n                // Make sure the sender ID can be searched\r\n                objectStore.createIndex('fcmSenderId', 'fcmSenderId', {\r\n                    unique: false\r\n                });\r\n                objectStore.createIndex('fcmToken', 'fcmToken', { unique: true });\r\n            }\r\n            case 1: {\r\n                // Prior to version 2, we were using either 'fcm_token_details_db'\r\n                // or 'undefined' as the database name due to bug in the SDK\r\n                // So remove the old tokens and databases.\r\n                cleanV1(this.services);\r\n            }\r\n            case 2: {\r\n                // Update from v2 to v4 directly in a single openCursor request.\r\n                // We need to do this because for some reason, doing a subsequent update on the same data\r\n                // in the same transaction drops the first update.\r\n                var objectStore = request.transaction.objectStore(this.objectStoreName);\r\n                var cursorRequest_1 = objectStore.openCursor();\r\n                cursorRequest_1.onsuccess = function () {\r\n                    var cursor = cursorRequest_1.result;\r\n                    if (cursor) {\r\n                        var value = cursor.value;\r\n                        var newValue = __assign({}, value);\r\n                        if (!value.createTime) {\r\n                            newValue.createTime = Date.now();\r\n                        }\r\n                        if (typeof value.vapidKey === 'string') {\r\n                            newValue.vapidKey = base64ToArrayBuffer(value.vapidKey);\r\n                        }\r\n                        if (typeof value.auth === 'string') {\r\n                            newValue.auth = base64ToArrayBuffer(value.auth).buffer;\r\n                        }\r\n                        if (typeof value.auth === 'string') {\r\n                            newValue.p256dh = base64ToArrayBuffer(value.p256dh).buffer;\r\n                        }\r\n                        if (typeof value.fcmPushSet === 'string') {\r\n                            delete newValue.fcmPushSet;\r\n                        }\r\n                        cursor.update(newValue);\r\n                        cursor.continue();\r\n                    }\r\n                };\r\n                // Break here as we've already updated to v4.\r\n                break;\r\n            }\r\n            case 3: {\r\n                // Update from V3 to V4.\r\n                var objectStore = request.transaction.objectStore(this.objectStoreName);\r\n                var cursorRequest_2 = objectStore.openCursor();\r\n                cursorRequest_2.onsuccess = function () {\r\n                    var cursor = cursorRequest_2.result;\r\n                    if (cursor) {\r\n                        var value = cursor.value;\r\n                        var newValue = __assign({}, value);\r\n                        if (typeof value.fcmPushSet === 'string') {\r\n                            delete newValue.fcmPushSet;\r\n                        }\r\n                        cursor.update(newValue);\r\n                        cursor.continue();\r\n                    }\r\n                };\r\n            }\r\n        }\r\n    };\r\n    /**\r\n     * Given a token, this method will look up the details in indexedDB.\r\n     */\r\n    TokenDetailsModel.prototype.getTokenDetailsFromToken = function (fcmToken) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!fcmToken) {\r\n                    throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n                }\r\n                validateInputs({ fcmToken: fcmToken });\r\n                return [2 /*return*/, this.getIndex('fcmToken', fcmToken)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Given a service worker scope, this method will look up the details in\r\n     * indexedDB.\r\n     * @return The details associated with that token.\r\n     */\r\n    TokenDetailsModel.prototype.getTokenDetailsFromSWScope = function (swScope) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!swScope) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                validateInputs({ swScope: swScope });\r\n                return [2 /*return*/, this.get(swScope)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Save the details for the fcm token for re-use at a later date.\r\n     * @param input A plain js object containing args to save.\r\n     */\r\n    TokenDetailsModel.prototype.saveTokenDetails = function (tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!tokenDetails.swScope) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                if (!tokenDetails.vapidKey) {\r\n                    throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n                }\r\n                if (!tokenDetails.endpoint || !tokenDetails.auth || !tokenDetails.p256dh) {\r\n                    throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n                }\r\n                if (!tokenDetails.fcmSenderId) {\r\n                    throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n                }\r\n                if (!tokenDetails.fcmToken) {\r\n                    throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n                }\r\n                validateInputs(tokenDetails);\r\n                return [2 /*return*/, this.put(tokenDetails)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes details of the current FCM token.\r\n     * It's returning a promise in case we need to move to an async\r\n     * method for deleting at a later date.\r\n     *\r\n     * @return Resolves once the FCM token details have been deleted and returns\r\n     * the deleted details.\r\n     */\r\n    TokenDetailsModel.prototype.deleteToken = function (token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var details;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof token !== 'string' || token.length === 0) {\r\n                            return [2 /*return*/, Promise.reject(errorFactory.create(\"invalid-delete-token\" /* INVALID_DELETE_TOKEN */))];\r\n                        }\r\n                        return [4 /*yield*/, this.getTokenDetailsFromToken(token)];\r\n                    case 1:\r\n                        details = _a.sent();\r\n                        if (!details) {\r\n                            throw errorFactory.create(\"delete-token-not-found\" /* DELETE_TOKEN_NOT_FOUND */);\r\n                        }\r\n                        return [4 /*yield*/, this.delete(details.swScope)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/, details];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return TokenDetailsModel;\r\n}(DbInterface));\r\n/**\r\n * This method takes an object and will check for known arguments and\r\n * validate the input.\r\n * @return Promise that resolves if input is valid, rejects otherwise.\r\n */\r\nfunction validateInputs(input) {\r\n    if (input.fcmToken) {\r\n        if (typeof input.fcmToken !== 'string' || input.fcmToken.length === 0) {\r\n            throw errorFactory.create(\"bad-token\" /* BAD_TOKEN */);\r\n        }\r\n    }\r\n    if (input.swScope) {\r\n        if (typeof input.swScope !== 'string' || input.swScope.length === 0) {\r\n            throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n        }\r\n    }\r\n    if (input.vapidKey) {\r\n        if (!(input.vapidKey instanceof Uint8Array) ||\r\n            input.vapidKey.length !== 65) {\r\n            throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n        }\r\n    }\r\n    if (input.endpoint) {\r\n        if (typeof input.endpoint !== 'string' || input.endpoint.length === 0) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.auth) {\r\n        if (!(input.auth instanceof ArrayBuffer)) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.p256dh) {\r\n        if (!(input.p256dh instanceof ArrayBuffer)) {\r\n            throw errorFactory.create(\"bad-subscription\" /* BAD_SUBSCRIPTION */);\r\n        }\r\n    }\r\n    if (input.fcmSenderId) {\r\n        if (typeof input.fcmSenderId !== 'string' ||\r\n            input.fcmSenderId.length === 0) {\r\n            throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n        }\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar UNCOMPRESSED_PUBLIC_KEY_SIZE = 65;\r\nvar VapidDetailsModel = /** @class */ (function (_super) {\r\n    __extends(VapidDetailsModel, _super);\r\n    function VapidDetailsModel() {\r\n        var _this = _super !== null && _super.apply(this, arguments) || this;\r\n        _this.dbName = 'fcm_vapid_details_db';\r\n        _this.dbVersion = 1;\r\n        _this.objectStoreName = 'fcm_vapid_object_Store';\r\n        return _this;\r\n    }\r\n    VapidDetailsModel.prototype.onDbUpgrade = function (request) {\r\n        var db = request.result;\r\n        db.createObjectStore(this.objectStoreName, { keyPath: 'swScope' });\r\n    };\r\n    /**\r\n     * Given a service worker scope, this method will look up the vapid key\r\n     * in indexedDB.\r\n     */\r\n    VapidDetailsModel.prototype.getVapidFromSWScope = function (swScope) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (typeof swScope !== 'string' || swScope.length === 0) {\r\n                            throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                        }\r\n                        return [4 /*yield*/, this.get(swScope)];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        return [2 /*return*/, result ? result.vapidKey : undefined];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Save a vapid key against a swScope for later date.\r\n     */\r\n    VapidDetailsModel.prototype.saveVapidDetails = function (swScope, vapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var details;\r\n            return __generator(this, function (_a) {\r\n                if (typeof swScope !== 'string' || swScope.length === 0) {\r\n                    throw errorFactory.create(\"bad-scope\" /* BAD_SCOPE */);\r\n                }\r\n                if (vapidKey === null || vapidKey.length !== UNCOMPRESSED_PUBLIC_KEY_SIZE) {\r\n                    throw errorFactory.create(\"bad-vapid-key\" /* BAD_VAPID_KEY */);\r\n                }\r\n                details = {\r\n                    swScope: swScope,\r\n                    vapidKey: vapidKey\r\n                };\r\n                return [2 /*return*/, this.put(details)];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes details of the current FCM VAPID key for a SW scope.\r\n     * Resolves once the scope/vapid details have been deleted and returns the\r\n     * deleted vapid key.\r\n     */\r\n    VapidDetailsModel.prototype.deleteVapidDetails = function (swScope) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var vapidKey;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getVapidFromSWScope(swScope)];\r\n                    case 1:\r\n                        vapidKey = _a.sent();\r\n                        if (!vapidKey) {\r\n                            throw errorFactory.create(\"delete-scope-not-found\" /* DELETE_SCOPE_NOT_FOUND */);\r\n                        }\r\n                        return [4 /*yield*/, this.delete(swScope)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/, vapidKey];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return VapidDetailsModel;\r\n}(DbInterface));\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Token should be refreshed once a week.\r\nvar TOKEN_EXPIRATION_MILLIS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nvar BaseController = /** @class */ (function () {\r\n    function BaseController(services) {\r\n        var _this = this;\r\n        this.services = services;\r\n        this.vapidDetailsModel = new VapidDetailsModel();\r\n        this.subscriptionManager = new SubscriptionManager();\r\n        var app = services.app;\r\n        this.app = app;\r\n        if (!app.options.messagingSenderId ||\r\n            typeof app.options.messagingSenderId !== 'string') {\r\n            throw errorFactory.create(\"bad-sender-id\" /* BAD_SENDER_ID */);\r\n        }\r\n        this.INTERNAL = {\r\n            delete: function () { return _this.delete(); }\r\n        };\r\n        this.tokenDetailsModel = new TokenDetailsModel(services);\r\n    }\r\n    BaseController.prototype.getToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permission, swReg, publicVapidKey, pushSubscription, tokenDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        permission = this.getNotificationPermission();\r\n                        if (!(permission === 'default')) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, this.requestNotificationPermission()];\r\n                    case 1:\r\n                        // The user hasn't allowed or denied notifications yet. Ask them.\r\n                        permission = _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        if (permission !== 'granted') {\r\n                            throw errorFactory.create(\"notifications-blocked\" /* NOTIFICATIONS_BLOCKED */);\r\n                        }\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 3:\r\n                        swReg = _a.sent();\r\n                        return [4 /*yield*/, this.getPublicVapidKey_()];\r\n                    case 4:\r\n                        publicVapidKey = _a.sent();\r\n                        return [4 /*yield*/, this.getPushSubscription(swReg, publicVapidKey)];\r\n                    case 5:\r\n                        pushSubscription = _a.sent();\r\n                        return [4 /*yield*/, this.tokenDetailsModel.getTokenDetailsFromSWScope(swReg.scope)];\r\n                    case 6:\r\n                        tokenDetails = _a.sent();\r\n                        if (tokenDetails) {\r\n                            return [2 /*return*/, this.manageExistingToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\r\n                        }\r\n                        return [2 /*return*/, this.getNewToken(swReg, pushSubscription, publicVapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * manageExistingToken is triggered if there's an existing FCM token in the\r\n     * database and it can take 3 different actions:\r\n     * 1) Retrieve the existing FCM token from the database.\r\n     * 2) If VAPID details have changed: Delete the existing token and create a\r\n     * new one with the new VAPID key.\r\n     * 3) If the database cache is invalidated: Send a request to FCM to update\r\n     * the token, and to check if the token is still valid on FCM-side.\r\n     */\r\n    BaseController.prototype.manageExistingToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var isTokenValid, now;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        isTokenValid = isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails);\r\n                        if (!isTokenValid) return [3 /*break*/, 1];\r\n                        now = Date.now();\r\n                        if (now < tokenDetails.createTime + TOKEN_EXPIRATION_MILLIS) {\r\n                            return [2 /*return*/, tokenDetails.fcmToken];\r\n                        }\r\n                        else {\r\n                            return [2 /*return*/, this.updateToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\r\n                        }\r\n                    case 1: \r\n                    // If the token is no longer valid (for example if the VAPID details\r\n                    // have changed), delete the existing token from the FCM client and server\r\n                    // database. No need to unsubscribe from the Service Worker as we have a\r\n                    // good push subscription that we'd like to use in getNewToken.\r\n                    return [4 /*yield*/, this.deleteTokenFromDB(tokenDetails.fcmToken)];\r\n                    case 2:\r\n                        // If the token is no longer valid (for example if the VAPID details\r\n                        // have changed), delete the existing token from the FCM client and server\r\n                        // database. No need to unsubscribe from the Service Worker as we have a\r\n                        // good push subscription that we'd like to use in getNewToken.\r\n                        _a.sent();\r\n                        return [2 /*return*/, this.getNewToken(swReg, pushSubscription, publicVapidKey)];\r\n                    case 3: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    BaseController.prototype.updateToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var updatedToken, allDetails, e_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 4, , 6]);\r\n                        return [4 /*yield*/, this.subscriptionManager.updateToken(tokenDetails, this.services, pushSubscription, publicVapidKey)];\r\n                    case 1:\r\n                        updatedToken = _a.sent();\r\n                        allDetails = {\r\n                            swScope: swReg.scope,\r\n                            vapidKey: publicVapidKey,\r\n                            fcmSenderId: this.services.app.options.messagingSenderId,\r\n                            fcmToken: updatedToken,\r\n                            createTime: Date.now(),\r\n                            endpoint: pushSubscription.endpoint,\r\n                            auth: pushSubscription.getKey('auth'),\r\n                            p256dh: pushSubscription.getKey('p256dh')\r\n                        };\r\n                        return [4 /*yield*/, this.tokenDetailsModel.saveTokenDetails(allDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2 /*return*/, updatedToken];\r\n                    case 4:\r\n                        e_1 = _a.sent();\r\n                        return [4 /*yield*/, this.deleteToken(tokenDetails.fcmToken)];\r\n                    case 5:\r\n                        _a.sent();\r\n                        throw e_1;\r\n                    case 6: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    BaseController.prototype.getNewToken = function (swReg, pushSubscription, publicVapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var newToken, allDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.subscriptionManager.getToken(this.services, pushSubscription, publicVapidKey)];\r\n                    case 1:\r\n                        newToken = _a.sent();\r\n                        allDetails = {\r\n                            swScope: swReg.scope,\r\n                            vapidKey: publicVapidKey,\r\n                            fcmSenderId: this.app.options.messagingSenderId,\r\n                            fcmToken: newToken,\r\n                            createTime: Date.now(),\r\n                            endpoint: pushSubscription.endpoint,\r\n                            auth: pushSubscription.getKey('auth'),\r\n                            p256dh: pushSubscription.getKey('p256dh')\r\n                        };\r\n                        return [4 /*yield*/, this.tokenDetailsModel.saveTokenDetails(allDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2 /*return*/, newToken];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method deletes tokens that the token manager looks after,\r\n     * unsubscribes the token from FCM  and then unregisters the push\r\n     * subscription if it exists. It returns a promise that indicates\r\n     * whether or not the unsubscribe request was processed successfully.\r\n     */\r\n    BaseController.prototype.deleteToken = function (token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var registration, pushSubscription;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: \r\n                    // Delete the token details from the database.\r\n                    return [4 /*yield*/, this.deleteTokenFromDB(token)];\r\n                    case 1:\r\n                        // Delete the token details from the database.\r\n                        _a.sent();\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 2:\r\n                        registration = _a.sent();\r\n                        if (!registration) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, registration.pushManager.getSubscription()];\r\n                    case 3:\r\n                        pushSubscription = _a.sent();\r\n                        if (pushSubscription) {\r\n                            return [2 /*return*/, pushSubscription.unsubscribe()];\r\n                        }\r\n                        _a.label = 4;\r\n                    case 4: \r\n                    // If there's no SW, consider it a success.\r\n                    return [2 /*return*/, true];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method will delete the token from the client database, and make a\r\n     * call to FCM to remove it from the server DB. Does not temper with the\r\n     * push subscription.\r\n     */\r\n    BaseController.prototype.deleteTokenFromDB = function (token) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var tokenDetails, e_2;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.tokenDetailsModel.deleteToken(token)];\r\n                    case 1:\r\n                        tokenDetails = _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        _a.trys.push([2, 4, , 5]);\r\n                        return [4 /*yield*/, this.subscriptionManager.deleteToken(this.services, tokenDetails)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 4:\r\n                        e_2 = _a.sent();\r\n                        // A failed server-side delete does not need to break the app.\r\n                        console.error(e_2);\r\n                        return [3 /*break*/, 5];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Gets a PushSubscription for the current user.\r\n     */\r\n    BaseController.prototype.getPushSubscription = function (swRegistration, publicVapidKey) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var subscription;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                    case 1:\r\n                        subscription = _a.sent();\r\n                        if (subscription) {\r\n                            return [2 /*return*/, subscription];\r\n                        }\r\n                        return [2 /*return*/, swRegistration.pushManager.subscribe({\r\n                                userVisibleOnly: true,\r\n                                applicationServerKey: publicVapidKey\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    //\r\n    // The following methods should only be available in the window.\r\n    //\r\n    /**\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    BaseController.prototype.requestPermission = function () {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.useServiceWorker = function (_registration) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.usePublicVapidKey = function (_b64PublicKey) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.onMessage = function (_nextOrObserver, _error, _completed) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    BaseController.prototype.onTokenRefresh = function (_nextOrObserver, _error, _completed) {\r\n        throw errorFactory.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    //\r\n    // The following methods are used by the service worker only.\r\n    //\r\n    BaseController.prototype.setBackgroundMessageHandler = function (_callback) {\r\n        throw errorFactory.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    //\r\n    // The following methods are used by the service themselves and not exposed\r\n    // publicly or not expected to be used by developers.\r\n    //\r\n    /**\r\n     * This method is required to adhere to the Firebase interface.\r\n     * It closes any currently open indexdb database connections.\r\n     */\r\n    BaseController.prototype.delete = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, Promise.all([\r\n                            this.tokenDetailsModel.closeDatabase(),\r\n                            this.vapidDetailsModel.closeDatabase()\r\n                        ])];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Returns the current Notification Permission state.\r\n     */\r\n    BaseController.prototype.getNotificationPermission = function () {\r\n        return Notification.permission;\r\n    };\r\n    /**\r\n     * Requests notification permission from the user.\r\n     */\r\n    BaseController.prototype.requestNotificationPermission = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (!Notification.requestPermission) {\r\n                    // Notification.requestPermission() is not available in service workers.\r\n                    // Return the current permission.\r\n                    return [2 /*return*/, Notification.permission];\r\n                }\r\n                return [2 /*return*/, Notification.requestPermission()];\r\n            });\r\n        });\r\n    };\r\n    BaseController.prototype.getTokenDetailsModel = function () {\r\n        return this.tokenDetailsModel;\r\n    };\r\n    BaseController.prototype.getVapidDetailsModel = function () {\r\n        return this.vapidDetailsModel;\r\n    };\r\n    // Visible for testing\r\n    // TODO: make protected\r\n    BaseController.prototype.getSubscriptionManager = function () {\r\n        return this.subscriptionManager;\r\n    };\r\n    return BaseController;\r\n}());\r\n/**\r\n * Checks if the tokenDetails match the details provided in the clients.\r\n */\r\nfunction isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails) {\r\n    if (!tokenDetails.vapidKey ||\r\n        !isArrayBufferEqual(publicVapidKey.buffer, tokenDetails.vapidKey.buffer)) {\r\n        return false;\r\n    }\r\n    var isEndpointEqual = pushSubscription.endpoint === tokenDetails.endpoint;\r\n    var isAuthEqual = isArrayBufferEqual(pushSubscription.getKey('auth'), tokenDetails.auth);\r\n    var isP256dhEqual = isArrayBufferEqual(pushSubscription.getKey('p256dh'), tokenDetails.p256dh);\r\n    return isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar FCM_MSG = 'FCM_MSG';\r\nvar SwController = /** @class */ (function (_super) {\r\n    __extends(SwController, _super);\r\n    function SwController(services) {\r\n        var _this = _super.call(this, services) || this;\r\n        _this.bgMessageHandler = null;\r\n        self.addEventListener('push', function (e) {\r\n            _this.onPush(e);\r\n        });\r\n        self.addEventListener('pushsubscriptionchange', function (e) {\r\n            _this.onSubChange(e);\r\n        });\r\n        self.addEventListener('notificationclick', function (e) {\r\n            _this.onNotificationClick(e);\r\n        });\r\n        return _this;\r\n    }\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onPush = function (event) {\r\n        event.waitUntil(this.onPush_(event));\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onSubChange = function (event) {\r\n        event.waitUntil(this.onSubChange_(event));\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.onNotificationClick = function (event) {\r\n        event.waitUntil(this.onNotificationClick_(event));\r\n    };\r\n    /**\r\n     * A handler for push events that shows notifications based on the content of\r\n     * the payload.\r\n     *\r\n     * The payload must be a JSON-encoded Object with a `notification` key. The\r\n     * value of the `notification` property will be used as the NotificationOptions\r\n     * object passed to showNotification. Additionally, the `title` property of the\r\n     * notification object will be used as the title.\r\n     *\r\n     * If there is no notification data in the payload then no notification will be\r\n     * shown.\r\n     */\r\n    SwController.prototype.onPush_ = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var msgPayload, hasVisibleClients, notificationDetails, notificationTitle, reg, actions, maxActions;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!event.data) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        try {\r\n                            msgPayload = event.data.json();\r\n                        }\r\n                        catch (err) {\r\n                            // Not JSON so not an FCM message\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, this.hasVisibleClients_()];\r\n                    case 1:\r\n                        hasVisibleClients = _a.sent();\r\n                        if (hasVisibleClients) {\r\n                            // App in foreground. Send to page.\r\n                            return [2 /*return*/, this.sendMessageToWindowClients_(msgPayload)];\r\n                        }\r\n                        notificationDetails = this.getNotificationData_(msgPayload);\r\n                        if (!notificationDetails) return [3 /*break*/, 3];\r\n                        notificationTitle = notificationDetails.title || '';\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 2:\r\n                        reg = _a.sent();\r\n                        actions = notificationDetails.actions;\r\n                        maxActions = Notification.maxActions;\r\n                        if (actions && maxActions && actions.length > maxActions) {\r\n                            console.warn(\"This browser only supports \" + maxActions + \" actions.\" +\r\n                                \"The remaining actions will not be displayed.\");\r\n                        }\r\n                        return [2 /*return*/, reg.showNotification(notificationTitle, notificationDetails)];\r\n                    case 3:\r\n                        if (!this.bgMessageHandler) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, this.bgMessageHandler(msgPayload)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onSubChange_ = function (_event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var registration, err_1, err_2, tokenDetailsModel, tokenDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        registration = _a.sent();\r\n                        return [3 /*break*/, 3];\r\n                    case 2:\r\n                        err_1 = _a.sent();\r\n                        throw errorFactory.create(\"unable-to-resubscribe\" /* UNABLE_TO_RESUBSCRIBE */, {\r\n                            errorInfo: err_1\r\n                        });\r\n                    case 3:\r\n                        _a.trys.push([3, 5, , 8]);\r\n                        return [4 /*yield*/, registration.pushManager.getSubscription()];\r\n                    case 4:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 8];\r\n                    case 5:\r\n                        err_2 = _a.sent();\r\n                        tokenDetailsModel = this.getTokenDetailsModel();\r\n                        return [4 /*yield*/, tokenDetailsModel.getTokenDetailsFromSWScope(registration.scope)];\r\n                    case 6:\r\n                        tokenDetails = _a.sent();\r\n                        if (!tokenDetails) {\r\n                            // This should rarely occure, but could if indexedDB\r\n                            // is corrupted or wiped\r\n                            throw err_2;\r\n                        }\r\n                        // Attempt to delete the token if we know it's bad\r\n                        return [4 /*yield*/, this.deleteToken(tokenDetails.fcmToken)];\r\n                    case 7:\r\n                        // Attempt to delete the token if we know it's bad\r\n                        _a.sent();\r\n                        throw err_2;\r\n                    case 8: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onNotificationClick_ = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var msgPayload, link, windowClient, internalMsg;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!event.notification ||\r\n                            !event.notification.data ||\r\n                            !event.notification.data[FCM_MSG]) {\r\n                            // Not an FCM notification, do nothing.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (event.action) {\r\n                            // User clicked on an action button.\r\n                            // This will allow devs to act on action button clicks by using a custom\r\n                            // onNotificationClick listener that they define.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Prevent other listeners from receiving the event\r\n                        event.stopImmediatePropagation();\r\n                        event.notification.close();\r\n                        msgPayload = event.notification.data[FCM_MSG];\r\n                        if (!msgPayload.notification) {\r\n                            // Nothing to do.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        link = (msgPayload.fcmOptions && msgPayload.fcmOptions.link) ||\r\n                            msgPayload.notification.click_action;\r\n                        if (!link) {\r\n                            if (msgPayload.data && FN_CAMPAIGN_ID in msgPayload.data) {\r\n                                link = self.location.origin;\r\n                            }\r\n                            else {\r\n                                // Nothing to do.\r\n                                return [2 /*return*/];\r\n                            }\r\n                        }\r\n                        return [4 /*yield*/, this.getWindowClient_(link)];\r\n                    case 1:\r\n                        windowClient = _a.sent();\r\n                        if (!!windowClient) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, self.clients.openWindow(link)];\r\n                    case 2:\r\n                        // Unable to find window client so need to open one.\r\n                        windowClient = _a.sent();\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        return [4 /*yield*/, sleep(3000)];\r\n                    case 3:\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        _a.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 4: return [4 /*yield*/, windowClient.focus()];\r\n                    case 5:\r\n                        windowClient = _a.sent();\r\n                        _a.label = 6;\r\n                    case 6:\r\n                        if (!windowClient) {\r\n                            // Window Client will not be returned if it's for a third party origin.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Delete notification and fcmOptions data from payload before sending to\r\n                        // the page.\r\n                        delete msgPayload.notification;\r\n                        delete msgPayload.fcmOptions;\r\n                        internalMsg = createNewMsg(MessageType.NOTIFICATION_CLICKED, msgPayload);\r\n                        // Attempt to send a message to the client to handle the data\r\n                        // Is affected by: https://github.com/slightlyoff/ServiceWorker/issues/728\r\n                        return [2 /*return*/, this.attemptToMessageClient_(windowClient, internalMsg)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.getNotificationData_ = function (msgPayload) {\r\n        var _a;\r\n        if (!msgPayload) {\r\n            return;\r\n        }\r\n        if (typeof msgPayload.notification !== 'object') {\r\n            return;\r\n        }\r\n        var notificationInformation = __assign({}, msgPayload.notification);\r\n        // Put the message payload under FCM_MSG name so we can identify the\r\n        // notification as being an FCM notification vs a notification from\r\n        // somewhere else (i.e. normal web push or developer generated\r\n        // notification).\r\n        notificationInformation.data = __assign(__assign({}, msgPayload.notification.data), (_a = {}, _a[FCM_MSG] = msgPayload, _a));\r\n        return notificationInformation;\r\n    };\r\n    /**\r\n     * Calling setBackgroundMessageHandler will opt in to some specific\r\n     * behaviours.\r\n     * 1.) If a notification doesn't need to be shown due to a window already\r\n     * being visible, then push messages will be sent to the page.\r\n     * 2.) If a notification needs to be shown, and the message contains no\r\n     * notification data this method will be called\r\n     * and the promise it returns will be passed to event.waitUntil.\r\n     * If you do not set this callback then all push messages will let and the\r\n     * developer can handle them in a their own 'push' event callback\r\n     *\r\n     * @param callback The callback to be called when a push message is received\r\n     * and a notification must be shown. The callback will be given the data from\r\n     * the push message.\r\n     */\r\n    SwController.prototype.setBackgroundMessageHandler = function (callback) {\r\n        if (!callback || typeof callback !== 'function') {\r\n            throw errorFactory.create(\"bg-handler-function-expected\" /* BG_HANDLER_FUNCTION_EXPECTED */);\r\n        }\r\n        this.bgMessageHandler = callback;\r\n    };\r\n    /**\r\n     * @param url The URL to look for when focusing a client.\r\n     * @return Returns an existing window client or a newly opened WindowClient.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.getWindowClient_ = function (url) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var parsedURL, clientList, suitableClient, i, parsedClientUrl;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        parsedURL = new URL(url, self.location.href).href;\r\n                        return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        suitableClient = null;\r\n                        for (i = 0; i < clientList.length; i++) {\r\n                            parsedClientUrl = new URL(clientList[i].url, self.location.href)\r\n                                .href;\r\n                            if (parsedClientUrl === parsedURL) {\r\n                                suitableClient = clientList[i];\r\n                                break;\r\n                            }\r\n                        }\r\n                        return [2 /*return*/, suitableClient];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This message will attempt to send the message to a window client.\r\n     * @param client The WindowClient to send the message to.\r\n     * @param message The message to send to the client.\r\n     * @returns Returns a promise that resolves after sending the message. This\r\n     * does not guarantee that the message was successfully received.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.attemptToMessageClient_ = function (client, message) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                // NOTE: This returns a promise in case this API is abstracted later on to\r\n                // do additional work\r\n                if (!client) {\r\n                    throw errorFactory.create(\"no-window-client-to-msg\" /* NO_WINDOW_CLIENT_TO_MSG */);\r\n                }\r\n                client.postMessage(message);\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @returns If there is currently a visible WindowClient, this method will\r\n     * resolve to true, otherwise false.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.hasVisibleClients_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var clientList;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        return [2 /*return*/, clientList.some(function (client) {\r\n                                return client.visibilityState === 'visible' &&\r\n                                    // Ignore chrome-extension clients as that matches the background pages\r\n                                    // of extensions, which are always considered visible.\r\n                                    !client.url.startsWith('chrome-extension://');\r\n                            })];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * @param msgPayload The data from the push event that should be sent to all\r\n     * available pages.\r\n     * @returns Returns a promise that resolves once the message has been sent to\r\n     * all WindowClients.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    SwController.prototype.sendMessageToWindowClients_ = function (msgPayload) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var clientList, internalMsg;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        internalMsg = createNewMsg(MessageType.PUSH_MSG_RECEIVED, msgPayload);\r\n                        return [4 /*yield*/, Promise.all(clientList.map(function (client) {\r\n                                return _this.attemptToMessageClient_(client, internalMsg);\r\n                            }))];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will register the default service worker and return the registration.\r\n     * @return he service worker registration to be used for the push service.\r\n     */\r\n    SwController.prototype.getSWRegistration_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                return [2 /*return*/, self.registration];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will return the default VAPID key or the uint8array version of the\r\n     * public VAPID key provided by the developer.\r\n     */\r\n    SwController.prototype.getPublicVapidKey_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var swReg, vapidKeyFromDatabase;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getSWRegistration_()];\r\n                    case 1:\r\n                        swReg = _a.sent();\r\n                        if (!swReg) {\r\n                            throw errorFactory.create(\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */);\r\n                        }\r\n                        return [4 /*yield*/, this.getVapidDetailsModel().getVapidFromSWScope(swReg.scope)];\r\n                    case 2:\r\n                        vapidKeyFromDatabase = _a.sent();\r\n                        if (vapidKeyFromDatabase == null) {\r\n                            return [2 /*return*/, DEFAULT_PUBLIC_VAPID_KEY];\r\n                        }\r\n                        return [2 /*return*/, vapidKeyFromDatabase];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SwController;\r\n}(BaseController));\r\nfunction getClientList() {\r\n    return self.clients.matchAll({\r\n        type: 'window',\r\n        includeUncontrolled: true\r\n        // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\r\n    });\r\n}\r\nfunction createNewMsg(msgType, msgData) {\r\n    return {\r\n        firebaseMessagingType: msgType,\r\n        firebaseMessagingData: msgData\r\n    };\r\n}\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WindowController = /** @class */ (function (_super) {\r\n    __extends(WindowController, _super);\r\n    /**\r\n     * A service that provides a MessagingService instance.\r\n     */\r\n    function WindowController(services) {\r\n        var _this = _super.call(this, services) || this;\r\n        _this.registrationToUse = null;\r\n        _this.publicVapidKeyToUse = null;\r\n        _this.messageObserver = null;\r\n        // @ts-ignore: Unused variable error, this is not implemented yet.\r\n        _this.tokenRefreshObserver = null;\r\n        _this.onMessageInternal = createSubscribe(function (observer) {\r\n            _this.messageObserver = observer;\r\n        });\r\n        _this.onTokenRefreshInternal = createSubscribe(function (observer) {\r\n            _this.tokenRefreshObserver = observer;\r\n        });\r\n        _this.setupSWMessageListener_();\r\n        return _this;\r\n    }\r\n    /**\r\n     * Request permission if it is not currently granted\r\n     *\r\n     * @return Resolves if the permission was granted, otherwise rejects\r\n     *\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    WindowController.prototype.requestPermission = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permissionResult;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (Notification.permission === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        permissionResult = _a.sent();\r\n                        if (permissionResult === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (permissionResult === 'denied') {\r\n                            throw errorFactory.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        else {\r\n                            throw errorFactory.create(\"permission-default\" /* PERMISSION_DEFAULT */);\r\n                        }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method allows a developer to override the default service worker and\r\n     * instead use a custom service worker.\r\n     *\r\n     * @param registration The service worker registration that should be used to\r\n     * receive the push messages.\r\n     */\r\n    WindowController.prototype.useServiceWorker = function (registration) {\r\n        if (!(registration instanceof ServiceWorkerRegistration)) {\r\n            throw errorFactory.create(\"sw-registration-expected\" /* SW_REGISTRATION_EXPECTED */);\r\n        }\r\n        if (this.registrationToUse != null) {\r\n            throw errorFactory.create(\"use-sw-before-get-token\" /* USE_SW_BEFORE_GET_TOKEN */);\r\n        }\r\n        this.registrationToUse = registration;\r\n    };\r\n    /**\r\n     * This method allows a developer to override the default vapid key\r\n     * and instead use a custom VAPID public key.\r\n     *\r\n     * @param publicKey A URL safe base64 encoded string.\r\n     */\r\n    WindowController.prototype.usePublicVapidKey = function (publicKey) {\r\n        if (typeof publicKey !== 'string') {\r\n            throw errorFactory.create(\"invalid-public-vapid-key\" /* INVALID_PUBLIC_VAPID_KEY */);\r\n        }\r\n        if (this.publicVapidKeyToUse != null) {\r\n            throw errorFactory.create(\"use-public-key-before-get-token\" /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */);\r\n        }\r\n        var parsedKey = base64ToArrayBuffer(publicKey);\r\n        if (parsedKey.length !== 65) {\r\n            throw errorFactory.create(\"public-vapid-key-decryption-failed\" /* PUBLIC_KEY_DECRYPTION_FAILED */);\r\n        }\r\n        this.publicVapidKeyToUse = parsedKey;\r\n    };\r\n    /**\r\n     * @export\r\n     * @param nextOrObserver An observer object or a function triggered on\r\n     * message.\r\n     * @param error A function triggered on message error.\r\n     * @param completed function triggered when the observer is removed.\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onMessage = function (nextOrObserver, error, completed) {\r\n        if (typeof nextOrObserver === 'function') {\r\n            return this.onMessageInternal(nextOrObserver, error, completed);\r\n        }\r\n        else {\r\n            return this.onMessageInternal(nextOrObserver);\r\n        }\r\n    };\r\n    /**\r\n     * @param nextOrObserver An observer object or a function triggered on token\r\n     * refresh.\r\n     * @param error A function triggered on token refresh error.\r\n     * @param completed function triggered when the observer is removed.\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    WindowController.prototype.onTokenRefresh = function (nextOrObserver, error, completed) {\r\n        if (typeof nextOrObserver === 'function') {\r\n            return this.onTokenRefreshInternal(nextOrObserver, error, completed);\r\n        }\r\n        else {\r\n            return this.onTokenRefreshInternal(nextOrObserver);\r\n        }\r\n    };\r\n    /**\r\n     * Given a registration, wait for the service worker it relates to\r\n     * become activer\r\n     * @param registration Registration to wait for service worker to become active\r\n     * @return Wait for service worker registration to become active\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    WindowController.prototype.waitForRegistrationToActivate_ = function (registration) {\r\n        var serviceWorker = registration.installing || registration.waiting || registration.active;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!serviceWorker) {\r\n                // This is a rare scenario but has occured in firefox\r\n                reject(errorFactory.create(\"no-sw-in-reg\" /* NO_SW_IN_REG */));\r\n                return;\r\n            }\r\n            // Because the Promise function is called on next tick there is a\r\n            // small chance that the worker became active or redundant already.\r\n            if (serviceWorker.state === 'activated') {\r\n                resolve(registration);\r\n                return;\r\n            }\r\n            if (serviceWorker.state === 'redundant') {\r\n                reject(errorFactory.create(\"sw-reg-redundant\" /* SW_REG_REDUNDANT */));\r\n                return;\r\n            }\r\n            var stateChangeListener = function () {\r\n                if (serviceWorker.state === 'activated') {\r\n                    resolve(registration);\r\n                }\r\n                else if (serviceWorker.state === 'redundant') {\r\n                    reject(errorFactory.create(\"sw-reg-redundant\" /* SW_REG_REDUNDANT */));\r\n                }\r\n                else {\r\n                    // Return early and wait to next state change\r\n                    return;\r\n                }\r\n                serviceWorker.removeEventListener('statechange', stateChangeListener);\r\n            };\r\n            serviceWorker.addEventListener('statechange', stateChangeListener);\r\n        });\r\n    };\r\n    /**\r\n     * This will register the default service worker and return the registration\r\n     * @return The service worker registration to be used for the push service.\r\n     */\r\n    WindowController.prototype.getSWRegistration_ = function () {\r\n        var _this = this;\r\n        if (this.registrationToUse) {\r\n            return this.waitForRegistrationToActivate_(this.registrationToUse);\r\n        }\r\n        // Make the registration null so we know useServiceWorker will not\r\n        // use a new service worker as registrationToUse is no longer undefined\r\n        this.registrationToUse = null;\r\n        return navigator.serviceWorker\r\n            .register(DEFAULT_SW_PATH, {\r\n            scope: DEFAULT_SW_SCOPE\r\n        })\r\n            .catch(function (err) {\r\n            throw errorFactory.create(\"failed-serviceworker-registration\" /* FAILED_DEFAULT_REGISTRATION */, {\r\n                browserErrorMessage: err.message\r\n            });\r\n        })\r\n            .then(function (registration) {\r\n            return _this.waitForRegistrationToActivate_(registration).then(function () {\r\n                _this.registrationToUse = registration;\r\n                // We update after activation due to an issue with Firefox v49 where\r\n                // a race condition occassionally causes the service worker to not\r\n                // install\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n                registration.update();\r\n                return registration;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This will return the default VAPID key or the uint8array version of the\r\n     * public VAPID key provided by the developer.\r\n     */\r\n    WindowController.prototype.getPublicVapidKey_ = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (this.publicVapidKeyToUse) {\r\n                    return [2 /*return*/, this.publicVapidKeyToUse];\r\n                }\r\n                return [2 /*return*/, DEFAULT_PUBLIC_VAPID_KEY];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method will set up a message listener to handle\r\n     * events from the service worker that should trigger\r\n     * events in the page.\r\n     */\r\n    // Visible for testing\r\n    // TODO: Make private\r\n    WindowController.prototype.setupSWMessageListener_ = function () {\r\n        var _this = this;\r\n        navigator.serviceWorker.addEventListener('message', function (event) { return __awaiter(_this, void 0, void 0, function () {\r\n            var _a, firebaseMessagingType, firebaseMessagingData, data, eventType, analytics;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!event.data ||\r\n                            !event.data.firebaseMessagingType ||\r\n                            !event.data.firebaseMessagingData) {\r\n                            // Not a message from FCM\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _a = event.data, firebaseMessagingType = _a.firebaseMessagingType, firebaseMessagingData = _a.firebaseMessagingData;\r\n                        if (this.messageObserver) {\r\n                            this.messageObserver.next(firebaseMessagingData);\r\n                        }\r\n                        data = firebaseMessagingData.data;\r\n                        if (!(data &&\r\n                            FN_CAMPAIGN_ID in data &&\r\n                            data[FN_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3 /*break*/, 2];\r\n                        eventType = getEventType(firebaseMessagingType);\r\n                        return [4 /*yield*/, this.services.analyticsProvider.get()];\r\n                    case 1:\r\n                        analytics = _b.sent();\r\n                        analytics.logEvent(eventType, \r\n                        /* eslint-disable camelcase */\r\n                        {\r\n                            message_name: data[FN_CAMPAIGN_NAME],\r\n                            message_id: data[FN_CAMPAIGN_ID],\r\n                            message_time: data[FN_CAMPAIGN_TIME],\r\n                            message_device_time: Math.floor(Date.now() / 1000)\r\n                        }\r\n                        /* eslint-enable camelcase */\r\n                        );\r\n                        _b.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        }); }, false);\r\n    };\r\n    return WindowController;\r\n}(BaseController));\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_MSG_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\n\nvar name = \"@firebase/messaging\";\nvar version = \"0.6.0\";\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerMessaging(instance) {\r\n    var messagingName = 'messaging';\r\n    var factoryMethod = function (container) {\r\n        /* Dependencies */\r\n        var app = container.getProvider('app').getImmediate();\r\n        var installations = container.getProvider('installations').getImmediate();\r\n        var analyticsProvider = container.getProvider('analytics-internal');\r\n        var firebaseServices = {\r\n            app: app,\r\n            installations: installations,\r\n            analyticsProvider: analyticsProvider\r\n        };\r\n        if (!isSupported()) {\r\n            throw errorFactory.create(\"unsupported-browser\" /* UNSUPPORTED_BROWSER */);\r\n        }\r\n        if (self && 'ServiceWorkerGlobalScope' in self) {\r\n            // Running in ServiceWorker context\r\n            return new SwController(firebaseServices);\r\n        }\r\n        else {\r\n            // Assume we are in the window context.\r\n            return new WindowController(firebaseServices);\r\n        }\r\n    };\r\n    var namespaceExports = {\r\n        isSupported: isSupported\r\n    };\r\n    instance.INTERNAL.registerComponent(new Component(messagingName, factoryMethod, \"PUBLIC\" /* PUBLIC */).setServiceProps(namespaceExports));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterMessaging(firebase);\r\nfunction isSupported() {\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return isSWControllerSupported();\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return isWindowControllerSupported();\r\n    }\r\n}\r\n/**\r\n * Checks to see if the required APIs exist.\r\n */\r\nfunction isWindowControllerSupported() {\r\n    return (navigator.cookieEnabled &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\r\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\r\nfunction isSWControllerSupported() {\r\n    return ('PushManager' in self &&\r\n        'Notification' in self &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n\nexport { isSupported, registerMessaging };\n//# sourceMappingURL=index.esm.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","import '@firebase/messaging';\n//# sourceMappingURL=index.esm.js.map\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = global || self, factory(global.idb = {}));\n}(this, function (exports) { 'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function(db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n"]}